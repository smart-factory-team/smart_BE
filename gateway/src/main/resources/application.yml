server:
  port: 8088
  forward-headers-strategy: framework

# Spring Security 비활성화
spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration
  security:
    user:
      password: none # Security 비활성화

---

spring:
  config:
    activate:
      on-profile: default
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration
  cloud:
    gateway:
      routes:
        - id: usermanagement
          uri: http://localhost:8082
          predicates:
            - Path=/userRegisterations/**, /users/**
        - id: report
          uri: http://localhost:8083
          predicates:
            - Path=/posts/**, /comments/**, /reports/**, /postReadmodels/**
        - id: approvalmanagement
          uri: http://localhost:8084
          predicates:
            - Path=/userApprovals/**
        - id: pressfaultdetection
          uri: http://localhost:8085
          predicates:
            - Path=/pressDefectDetectionLogs/**, /pressFaultDetectionLogs/**
        - id: chatbot
          uri: http://localhost:8086
          predicates:
            - Path=/agentSessions/**, /issues/**
        - id: paintingprocessmonitoring
          uri: http://localhost:8087
          predicates:
            - Path=/paintingSurfaceDefectDetectionLogs/**, /paintingProcessEquipmentDefectDetectionLogs/**
        - id: assemblyprocessmonitoring
          uri: http://localhost:8090
          predicates:
            - Path=/vehicleAssemblyProcessDefectDetectionLogs/**
        - id: weldingprocessmonitoring
          uri: http://localhost:8089
          predicates:
            - Path=/weldingMachineDefectDetectionLogs/**
        - id: frontend
          uri: http://localhost:8080
          predicates:
            - Path=/**
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: [ "*" ]
            allowedMethods: [ "*" ]
            allowedHeaders: [ "*" ]
            allowCredentials: false

---

spring:
  config:
    activate:
      on-profile: docker
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration
  cloud:
    gateway:
      routes:
        - id: usermanagement
          uri: http://usermanagement:8080
          predicates:
            - Path=/userRegisterations/**, /users/**
        - id: report
          uri: http://report:8080
          predicates:
            - Path=/posts/**, /comments/**, /reports/**
        - id: approvalmanagement
          uri: http://approvalmanagement:8080
          predicates:
            - Path=/userApprovals/**
        - id: pressfaultdetection
          uri: http://pressfaultdetection:8080
          predicates:
            - Path=/pressDefectDetectionLogs/**, /pressFaultDetectionLogs/**
        - id: chatbot
          uri: http://chatbot:8080
          predicates:
            - Path=/agentSessions/**, /issues/**
        - id: paintingprocessmonitoring
          uri: http://paintingprocessmonitoring:8080
          predicates:
            - Path=/paintingSurfaceDefectDetectionLogs/**, /paintingProcessEquipmentDefectDetectionLogs/**
        - id: assemblyprocessmonitoring
          uri: http://assemblyprocessmonitoring:8080
          predicates:
            - Path=/vehicleAssemblyProcessDefectDetectionLogs/**
        - id: weldingprocessmonitoring
          uri: http://weldingprocessmonitoring:8080
          predicates:
            - Path=/weldingMachineDefectDetectionLogs/**
        - id: frontend
          uri: http://frontend:8080
          predicates:
            - Path=/**
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: [ "*" ]
            allowedMethods: [ "*" ]
            allowedHeaders: [ "*" ]
            allowCredentials: false

---

spring:
  config:
    activate:
      on-profile: kubernetes
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
      - org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration
  cloud:
    gateway:
      httpclient:
        connect-timeout: 5000
        response-timeout: 30s
      routes:
        # ===== Spring Boot Microservices =====
        - id: usermanagement
          uri: http://usermanagement.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/userRegisterations/**, /users/**
        - id: report
          uri: http://report.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/posts/**, /comments/**, /reports/**
        - id: approvalmanagement
          uri: http://approvalmanagement.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/userApprovals/**
        - id: pressfaultdetection
          uri: http://pressfaultdetection.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/pressDefectDetectionLogs/**, /pressFaultDetectionLogs/**
        - id: chatbot
          uri: http://chatbot.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/agentSessions/**, /issues/**
        - id: paintingprocessmonitoring
          uri: http://paintingprocessmonitoring.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/paintingSurfaceDefectDetectionLogs/**, /paintingProcessEquipmentDefectDetectionLogs/**
        - id: assemblyprocessmonitoring
          uri: http://assemblyprocessmonitoring.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/vehicleAssemblyProcessDefectDetectionLogs/**
        - id: weldingprocessmonitoring
          uri: http://weldingprocessmonitoring.smart-be.svc.cluster.local:8080
          predicates:
            - Path=/weldingMachineDefectDetectionLogs/**

        # ===== FastAPI AI Services (CI/CD 배포명과 일치) =====
        # Welding - Model Serving
        - id: welding-defect-detection-api
          uri: http://sf-welding-machine-defect-detection-model-service.sf-welding-machine-defect-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/welding/defect, /api/v1/welding/defect/**
          filters:
            - RewritePath=/api/v1/welding/defect$, /
            - RewritePath=/api/v1/welding/defect/(?<segment>.*), /${segment}

        # Welding - Data Simulator
        - id: welding-data-simulator-api
          uri: http://sf-welding-machine-data-simulator-service.sf-welding-machine-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/welding/simulator, /api/v1/welding/simulator/**
          filters:
            - RewritePath=/api/v1/welding/simulator$, /
            - RewritePath=/api/v1/welding/simulator/(?<segment>.*), /${segment}

        # Painting - Process Defect
        - id: painting-process-defect-api
          uri: http://sf-painting-process-equipment-defect-detection-model-service.sf-painting-process-equipment-defect-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/painting/process/defect, /api/v1/painting/process/defect/**
          filters:
            - RewritePath=/api/v1/painting/process/defect$, /
            - RewritePath=/api/v1/painting/process/defect/(?<segment>.*), /${segment}

        # Painting - Surface Defect
        - id: painting-surface-defect-api
          uri: http://sf-painting-surface-defect-detection-model-service.sf-painting-surface-defect-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/painting/surface/defect, /api/v1/painting/surface/defect/**
          filters:
            - RewritePath=/api/v1/painting/surface/defect$, /
            - RewritePath=/api/v1/painting/surface/defect/(?<segment>.*), /${segment}

        # Press - Defect
        - id: press-defect-detection-api
          uri: http://sf-press-defect-detection-model-service.sf-press-defect-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/press/defect, /api/v1/press/defect/**
          filters:
            - RewritePath=/api/v1/press/defect$, /
            - RewritePath=/api/v1/press/defect/(?<segment>.*), /${segment}

        # Press - Fault
        - id: press-fault-detection-api
          uri: http://sf-press-fault-detection-model-service.sf-press-fault-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/press/fault, /api/v1/press/fault/**
          filters:
            - RewritePath=/api/v1/press/fault$, /
            - RewritePath=/api/v1/press/fault/(?<segment>.*), /${segment}

        # Vehicle Assembly
        - id: vehicle-assembly-defect-api
          uri: http://sf-vehicle-assembly-process-defect-detection-model-service.sf-vehicle-assembly-process-defect-detection-model-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/vehicle/assembly/defect, /api/v1/vehicle/assembly/defect/**
          filters:
            - RewritePath=/api/v1/vehicle/assembly/defect$, /
            - RewritePath=/api/v1/vehicle/assembly/defect/(?<segment>.*), /${segment}

        # ===== Data Simulators =====
        - id: painting-process-simulator-api
          uri: http://sf-painting-process-data-simulator-service.sf-painting-process-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/painting/process/simulator, /api/v1/painting/process/simulator/**
          filters:
            - RewritePath=/api/v1/painting/process/simulator$, /
            - RewritePath=/api/v1/painting/process/simulator/(?<segment>.*), /${segment}

        - id: painting-surface-simulator-api
          uri: http://sf-painting-surface-data-simulator-service.sf-painting-surface-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/painting/surface/simulator, /api/v1/painting/surface/simulator/**
          filters:
            - RewritePath=/api/v1/painting/surface/simulator$, /
            - RewritePath=/api/v1/painting/surface/simulator/(?<segment>.*), /${segment}

        - id: press-defect-simulator-api
          uri: http://sf-press-defect-data-simulator-service.sf-press-defect-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/press/defect/simulator, /api/v1/press/defect/simulator/**
          filters:
            - RewritePath=/api/v1/press/defect/simulator$, /
            - RewritePath=/api/v1/press/defect/simulator/(?<segment>.*), /${segment}

        - id: press-fault-simulator-api
          uri: http://sf-press-fault-data-simulator-service.sf-press-fault-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/press/fault/simulator, /api/v1/press/fault/simulator/**
          filters:
            - RewritePath=/api/v1/press/fault/simulator$, /
            - RewritePath=/api/v1/press/fault/simulator/(?<segment>.*), /${segment}

        - id: vehicle-assembly-simulator-api
          uri: http://sf-vehicle-assembly-data-simulator-service.sf-vehicle-assembly-data-simulator-service.svc.cluster.local:80
          predicates:
            - Path=/api/v1/vehicle/assembly/simulator, /api/v1/vehicle/assembly/simulator/**
          filters:
            - RewritePath=/api/v1/vehicle/assembly/simulator$, /
            - RewritePath=/api/v1/vehicle/assembly/simulator/(?<segment>.*), /${segment}

        # ===== Frontend (catch-all) =====
        - id: frontend
          uri: http://frontend:8080
          predicates:
            - Path=/**
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: [ "*" ]
            allowedMethods: [ "*" ]
            allowedHeaders: [ "*" ]
            allowCredentials: false